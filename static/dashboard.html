<!DOCTYPE html>
<html>
<head>
  <title>ðŸ“Š AI Money Web :: Live Trade Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #0f172a; color: #e2e8f0; }
    h1 { color: #38bdf8; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #1e293b; }
    th, td { border: 1px solid #334155; padding: 8px; text-align: left; }
    th { background: #0ea5e9; color: white; }
    canvas { background: #020617; border: 1px solid #334155; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ðŸš€ AI Money Web :: Live Trades</h1>
  <p>Phase 341â€“380 â€” Realtime analytics dashboard with trend visualization.</p>

  <h2>ðŸ“ˆ Trade Price Chart</h2>
  <canvas id="tradeChart" width="900" height="400"></canvas>

  <h2>ðŸ§¾ Recent Trades</h2>
  <table>
    <thead><tr><th>Timestamp</th><th>Symbol</th><th>Action</th><th>Price</th><th>Qty</th></tr></thead>
    <tbody id="trades"></tbody>
  </table>

  <script>
    async function loadTrades() {
      const r = await fetch('/api/live_trades');
      const json = await r.json();
      const trades = json.trades || [];

      const labels = trades.map(t => new Date(t.timestamp).toLocaleTimeString());
      const prices = trades.map(t => t.price);
      const colors = trades.map(t => t.action === 'buy' ? 'rgb(34,197,94)' : 'rgb(239,68,68)');

      const ctx = document.getElementById('tradeChart').getContext('2d');
      if (window.tradeChart) window.tradeChart.destroy();
      window.tradeChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels.reverse(),
          datasets: [{
            label: 'Trade Prices',
            data: prices.reverse(),
            borderWidth: 2,
            borderColor: '#38bdf8',
            pointBackgroundColor: colors.reverse(),
            fill: false,
            tension: 0.25
          }]
        },
        options: {
          scales: { y: { beginAtZero: false } },
          plugins: { legend: { display: true, labels: { color: '#f8fafc' } } }
        }
      });

      const tbody = document.getElementById('trades');
      tbody.innerHTML = '';
      trades.forEach(t => {
        const row = `<tr>
          <td>${t.timestamp}</td>
          <td>${t.symbol}</td>
          <td style="color:${t.action === 'buy' ? 'lime' : 'red'}">${t.action}</td>
          <td>${t.price}</td>
          <td>${t.qty}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    // Initial load + refresh every 5 seconds
    loadTrades();
    setInterval(loadTrades, 5000);
  </script>
</body>
</html>

